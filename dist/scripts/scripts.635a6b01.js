"use strict";function generateGraph(a,b){calcShopBudgets(a,b);var c=450;a.budgets=[{budgetname:"ShopBudget",color:"#f1b62d",amount:a.shop.shopbudget},{budgetname:"Amended Budget",color:"#b44322",amount:a.shop.amendedbudget},{budgetname:"Amount Utilized",color:"#72ba22",amount:a.shop.utilizedbudget}];var d=a.budgets[0].amount;d=a.budgets[0].amount>a.budgets[1].amount&&a.budgets[0].amount>a.budgets[2].amount?a.budgets[0].amount:a.budgets[1].amount>a.budgets[0].amount&&a.budgets[1].amount>a.budgets[2].amount?a.budgets[1].amount:a.budgets[2].amount,a.budgets[0].width=c/d*a.budgets[0].amount,a.budgets[1].width=c/d*a.budgets[1].amount,a.budgets[2].width=c/d*a.budgets[2].amount,a.utilisationTitle="%Utilization",a.utilisation={percent:a.budgets[2].amount<=0?0:100/a.budgets[1].amount*a.budgets[2].amount}}function loadShopData(a,b,c,d,e){c.getHeads().success(function(c){c&&c.results&&(a.heads=c.results.filter(function(a){var b=(new Date).getFullYear();return a.year==b?a:""}),d.getRequitisions().success(function(c){c&&c.results&&(a.requisitions=c.results,e.getPO().success(function(c){if(c&&c.results){a.po=c.results;for(var d=0;d<a.requisitions.length;d++){a.requisitions[d].po=[];for(var e=0;e<a.po.length;e++)a.requisitions[d]._id==a.po[e].requsitionid&&a.requisitions[d].po.push(a.po[e])}}for(var f=0;f<a.heads.length;f++){a.heads[f].requisitions=[],a.heads[f].amountutilized=0,a.heads[f].amendedbudget=a.heads[f].amendedbudget?a.heads[f].amendedbudget:a.heads[f].budget;for(var g=0;g<a.requisitions.length;g++){a.heads[f]._id==a.requisitions[g].headid&&a.heads[f].requisitions.push(a.requisitions[g]);for(var d=0;d<a.po.length;d++)a.heads[f]._id==a.requisitions[g].headid&&a.po[d].requsitionid==a.requisitions[g]._id&&(a.heads[f].amountutilized=parseFloat(a.heads[f].amountutilized)+parseFloat(a.po[d].amount))}}generateGraph(a,b)}))}),b.heads=a.heads)})}function calcShopBudgets(a,b){for(var c=0;c<b.shops.length;c++){b.shops[c].amendedbudget=0,b.shops[c].utilizedbudget=0;for(var d=0;d<a.heads.length;d++)b.shops[c]._id==a.heads[d].shopid&&(b.shops[c].amendedbudget=parseFloat(b.shops[c].amendedbudget)+parseFloat(a.heads[d].amendedbudget),b.shops[c].utilizedbudget=parseFloat(b.shops[c].utilizedbudget)+parseFloat(a.heads[d].amountutilized));a.shop._id==b.shops[c]._id&&(a.shop=b.shops[c])}}angular.module("budgetTrackingApp",["ngAnimate","ngSanitize","ngRoute","ngDialog","720kb.datepicker"]);var app=angular.module("budgetTrackingApp");app.constant("entribServices",{queryParams:"?customerid=1&userid=1",shopURL:"http://jira.entrib.com/server/elements/shop/records",headURL:"http://jira.entrib.com/server/elements/head/records",requisitionURL:"http://jira.entrib.com/server/elements/requisition/records",poURL:"http://jira.entrib.com/server/elements/po/records",yearURL:"http://jira.entrib.com/server/elements/financialyear/records"}),angular.module("budgetTrackingApp").config(["$routeProvider",function(a){a.when("/home",{templateUrl:"views/shopsummary.html",controller:"ShopCtrl"}).when("/requisition",{templateUrl:"views/requisition.html",controller:"RequisitionCtrl"}).otherwise({redirectTo:"/home"})}]),angular.module("budgetTrackingApp").controller("ShopCtrl",["$scope","$rootScope","ShopService","$location",function(a,b,c,d){a.getShops=function(){c.getShops().success(function(c){c&&c.results&&(a.shops=c.results,b.shops=a.shops,b.selectedShopForNav||(a.selectedShopForNav=a.shops[0],b.selectedShopForNav=a.selectedShopForNav),b.$emit("shopselected",a.selectedShopForNav))})},a.getShops(),a.selectShop=function(c){a.selectedShopForNav=c,b.selectedShopForNav=a.selectedShopForNav,b.$emit("shopselected",a.selectedShopForNav),d.path("home")}}]),angular.module("budgetTrackingApp").controller("MainCtrl",["$scope","$rootScope","HeadService","RequisitionService","POService","ngDialog","YearService",function(a,b,c,d,e,f,g){b.$on("shopselected",function(f,h){a.shop=h,a.heads?generateGraph(a,b):g.getYear().success(function(f){b.startoftheyear=f.startoftheyear,loadShopData(a,b,c,d,e)})}),a.updateBudgetHead=function(d,e){""==e.amendedbudget&&(e.amendedbudget=0),e.amendedbudget&&"0"==e.amendedbudget.slice(0,1)&&e.amendedbudget.length>1&&(e.amendedbudget=e.amendedbudget.slice(1,e.amendedbudget.length)),13==d&&(e.isupdating=!0,c.updateHead(e._id,{amendedbudget:e.amendedbudget}).success(function(){e.isupdating=!1,generateGraph(a,b)})),generateGraph(a,b)},a.approveRequisition=function(a){a.isupdating=!0,d.updateRequitision(a._id,{isapproved:a.isapproved}).success(function(){a.isupdating=!1})},a.openHead=function(c){a.activeHead==c?a.activeHead=void 0:(a.activeHead=c,b.activeHead=a.activeHead)},a.createHead=function(){a.newhead={shopid:a.shop._id},a.createHeadDialog=f.open({template:"../../views/createHead.html",className:"ngdialog-theme-default",scope:a})},a.saveHead=function(){a.isHeadSaving=!0,c.saveHead(a.newhead).success(function(){a.isHeadSaving=!1,loadShopData(a,b,c,d,e),f.close(a.createHeadDialog)})},a.groupBudget=function(){a.totalBudget=0,a.totalAmendedBudget=0,a.totalUtilizedBudget=0;for(var c=0;c<b.shops.length;c++)a.totalBudget=parseFloat(a.totalBudget)+parseFloat(b.shops[c].shopbudget),a.totalAmendedBudget=parseFloat(a.totalAmendedBudget)+parseFloat(b.shops[c].amendedbudget),a.totalUtilizedBudget=parseFloat(a.totalUtilizedBudget)+parseFloat(b.shops[c].utilizedbudget);f.open({template:"../../views/groupBudget.html",className:"ngdialog-theme-default",scope:a,width:"60%"})},a.createPo=function(b){a.newpo={requsitionid:b._id,ponumber:a.po.length>0&&a.po[a.po.length-1].ponumber?a.po[a.po.length-1].ponumber+1:1,date:(new Date).getDate()+"-"+(new Date).getMonth()+"-"+(new Date).getFullYear()},a.createPoDialog=f.open({template:"../../views/createPO.html",className:"ngdialog-theme-default",scope:a})},a.savePO=function(){a.isPOSaving=!0,e.savePO(a.newpo).success(function(){a.isPOSaving=!1,loadShopData(a,b,c,d,e),f.close(a.createPoDialog)})}}]),angular.module("budgetTrackingApp").controller("HeadCtrl",["$scope",function(a){a.user={id:"1",name:"Ranjeet Verma"}}]),angular.module("budgetTrackingApp").controller("RequisitionCtrl",["$scope","$rootScope","RequisitionService",function(a,b,c){a.today=new Date,a.activeHead=b.activeHead,a.selectedShopForNav=b.selectedShopForNav,a.categories=["Productivity","Quality","Cost","Delivery","SHE","Replacement","Reconditioning","New Model","Introduction","Others"],a.heads=b.heads,a.newrequisition={headid:a.activeHead._id,category:a.categories[0],shopname:a.selectedShopForNav.shopname,suppliers:[]},a.saveRequisition=function(){a.newrequisition.supplier1=a.newrequisition.suppliers[0],a.newrequisition.supplier2=a.newrequisition.suppliers[1],a.newrequisition.supplier3=a.newrequisition.suppliers[2],a.newrequisition.selectedsupplier==a.newrequisition.supplier1&&(a.newrequisition.amount=a.newrequisition.negotiatedcost1),a.newrequisition.selectedsupplier==a.newrequisition.supplier2&&(a.newrequisition.amount=a.newrequisition.negotiatedcost2),a.newrequisition.selectedsupplier==a.newrequisition.supplier3&&(a.newrequisition.amount=a.newrequisition.negotiatedcost3),c.saveRequitision(a.newrequisition)}}]),angular.module("budgetTrackingApp").factory("ShopService",["$http","entribServices",function(a,b){return{getShops:function(){return a.get(b.shopURL+b.queryParams)}}}]),angular.module("budgetTrackingApp").factory("HeadService",["$http","entribServices",function(a,b){return{getHeads:function(){return a.get(b.headURL+b.queryParams)},updateHead:function(c,d){return a.put(b.headURL+"/"+c+b.queryParams,d)},saveHead:function(c){return c.newhead="true",c.siteName="abc",a.post(b.headURL+b.queryParams,c)}}}]),angular.module("budgetTrackingApp").factory("RequisitionService",["$http","entribServices",function(a,b){return{getRequitisions:function(){return a.get(b.requisitionURL+b.queryParams)},updateRequitision:function(c,d){return a.put(b.requisitionURL+"/"+c+b.queryParams,d)},saveRequitision:function(c){return c.siteName="abc",a.post(b.requisitionURL+b.queryParams,c)}}}]),angular.module("budgetTrackingApp").factory("POService",["$http","entribServices",function(a,b){return{getPO:function(){return a.get(b.poURL+b.queryParams)},savePO:function(c){return c.siteName="abc",a.post(b.poURL+b.queryParams,c)}}}]),angular.module("budgetTrackingApp").factory("YearService",["$http","entribServices",function(a,b){return{getYear:function(){return a.get(b.yearURL+b.queryParams)}}}]),angular.module("budgetTrackingApp").directive("budgetHead",function(){return{restrict:"E",templateUrl:"scripts/directives/budgetHeadTemplate.html"}}),angular.module("budgetTrackingApp").directive("budgetRequisition",function(){return{restrict:"E",templateUrl:"scripts/directives/budgetRequisitionTemplate.html"}}),angular.module("budgetTrackingApp").directive("budgetPo",function(){return{restrict:"E",templateUrl:"scripts/directives/budgetPOTemplate.html"}}),angular.module("budgetTrackingApp").filter("shop",function(){return function(a,b){for(var c=[],d=0;a&&d<a.length;d++)a[d].shopid==b&&c.push(a[d]);return c}}),angular.module("budgetTrackingApp").filter("length",function(){return function(a,b){if(b=parseInt(b),isNaN(a)||isNaN(b))return a;if(a.toString().length<b){for(var c=a.toString().length;b>c;c++)a="0"+a;return a}return a}}),angular.module("budgetTrackingApp").run(["$templateCache",function(a){a.put("views/createHead.html",'<div> <h1> Create New Head</h1> <form class="dialog-form"> <div> <input type="hidden" ng-model="newhead.shopid" class="control"> </div> <div> <span class="label">Description</span> <input type="text" ng-model="newhead.headname" class="control"> </div> <div> <span class="label">Budget</span> <input type="text" ng-model="newhead.budget" class="control"> </div> <div> <span class="label">Head Code</span> <input type="text" ng-model="newhead.headcode" class="control"> </div> <div> <span class="label">Remarks</span> <textarea ng-model="newhead.remarks" class="control"></textarea> </div> <div ng-hide="isHeadSaving" style="overflow: hidden"> <a class="button-grashgreen" ng-click="saveHead()" class="control"> Save </a> </div> </form> </div>'),a.put("views/createPO.html",'<div> <h1> Create New PO </h1> <form class="dialog-form"> <div> <input type="hidden" ng-model="newpo.requisitionid" class="control"> </div> <div> <span class="label">PO No</span> <span class="control"><strong>{{newpo.ponumber | length : \'3\'}}</strong></span> </div> <div> <span class="label">PO Date</span> <datepicker date-format="dd-MM-yyyy"> <input ng-model="newpo.date" type="text" class="control"> </datepicker> </div> <div> <span class="label">PO Amount</span> <input type="text" ng-model="newpo.amount" class="control"> </div> <div> <span class="label">Description</span> <textarea ng-model="newpo.description" class="control"></textarea> </div> <div ng-hide="isPOSaving" style="overflow: hidden"> <a class="button-grashgreen" ng-click="savePO()" class="control"> Save </a> </div> </form> </div>'),a.put("views/groupBudget.html",'<h1>Group Budget</h1> <table cellpadding="0" cellspacing="0" class="group-budget"> <thead> <tr> <td>Shop Name</td> <td>Shop Budget</td> <td>Amended Budget</td> <td>Utilized Budget</td> </tr> </thead> <tbody> <tr ng-repeat="shop in shops"> <td>{{shop.shopname}}</td> <td>{{shop.shopbudget | currency:"Rs. "}}</td> <td>{{shop.amendedbudget | currency:"Rs. "}}</td> <td>{{shop.utilizedbudget | currency:"Rs. "}}</td> </tr> <tr> <td><strong>Total</strong></td> <td><strong>{{totalBudget | currency:"Rs. "}}</strong></td> <td><strong>{{totalAmendedBudget | currency:"Rs. "}}</strong></td> <td><strong>{{totalUtilizedBudget | currency:"Rs. "}}</strong></td> </tr> </tbody> </table>'),a.put("views/header.html",'<div class="header"> <div> <img ng-src="images/bajajlogo.c08666d5.png" class="logo"> <div class="user" ng-controller="HeadCtrl"> <span class="username">{{ user.name }}</span> <i class="fa fa-angle-down user-menu" aria-hidden="true"></i> </div> </div> </div>'),a.put("views/requisition.html",'<div class="form-container" ng-controller="RequisitionCtrl"> <div class="form-title"> <div class="title">Fixed Cost Requestion Form</div> </div> <div class="form-title"> <div class="division-name">Division: {{selectedShopForNav.division}}</div> <div class="budget-name">Budget Head: {{activeHead.headname}}</div> <div class="date"> <div class="newhead" ng-hide="activeHead.newhead != \'true\'">New Head</div> <div>Date: {{ today | date:"dd/MM/yyyy"}}</div> </div> </div> <form class="container"> <div class="form-row"> <div class="form-cols-1">Requisition Number:</div> <div class="form-cols-1"> {{selectedShopForNav.division}}/{{selectedShopForNav.shotname}}/{{activeHead.year}}/001 </div> <div class="form-cols-2">Shop: <strong>{{newrequisition.shopname}}</strong></div> <div class="form-cols-1">Cell: <input type="text" class="input-4" ng-model="newrequisition.cell"> </div> </div> <div class="form-row"> <div class="form-cols-1">Requirment Description:</div> <div class="form-cols-3"> <textarea type="text" class="input-7" ng-model="newrequisition.description"></textarea> </div> <div class="form-cols-1">Qty: <input type="text" class="input-2" ng-model="newrequisition.qty"> </div> </div> <div class="form-row"> <div class="form-cols-1">Category:</div> <div class="form-cols-1"> <select class="input-6" style="margin-left: 4px" ng-options="category as category for category in categories" ng-model="newrequisition.category"></select> </div> <div class="form-cols-2">Detail: <textarea type="text" class="input-6" style="width:77%" ng-model="newrequisition.categorydetails"></textarea> </div> </div> <div class="form-row"> <div class="form-cols-1">Justification:</div> <div class="form-cols-3"> <textarea type="text" class="input-7" ng-model="newrequisition.justification"></textarea> </div> </div> <div class="form-row"> <div class="form-cols-1">Quotation Received From:</div> <div class="form-cols-1"> <input type="text" class="input-6" ng-model="newrequisition.suppliers[0]"> </div> <div class="form-cols-1"> <input type="text" class="input-6" ng-model="newrequisition.suppliers[1]"> </div> <div class="form-cols-1"> <input type="text" class="input-6" ng-model="newrequisition.suppliers[2]"> </div> </div> <div class="form-row"> <div class="form-cols-1">Quoted Cost:</div> <div class="form-cols-1"> <input type="text" class="input-6" ng-model="newrequisition.quotedcost1"> </div> <div class="form-cols-1"> <input type="text" class="input-6" ng-model="newrequisition.quotedcost2"> </div> <div class="form-cols-1"> <input type="text" class="input-6" ng-model="newrequisition.quotedcost3"> </div> </div> <div class="form-row"> <div class="form-cols-1">Negotiated Cost:</div> <div class="form-cols-1"> <input type="text" class="input-6" ng-model="newrequisition.negotiatedcost1"> </div> <div class="form-cols-1"> <input type="text" class="input-6" ng-model="newrequisition.negotiatedcost2"> </div> <div class="form-cols-1"> <input type="text" class="input-6" ng-model="newrequisition.negotiatedcost3"> </div> </div> <div class="form-row"> <div class="form-cols-1">Selected Supplier:</div> <div class="form-cols-1"> <select class="input-6" ng-options="supplier as supplier for supplier in newrequisition.suppliers" ng-model="newrequisition.selectedsupplier"></select> </div> <div class="form-cols-1">Reason For Selection:</div> <div class="form-cols-1"> <textarea type="text" class="input-6" ng-model="newrequisition.reasonsuppliersection"></textarea> </div> </div> </form> <div class="container"> <div class="form-row"> <div class="form-cols-1">Budget</div> <div class="form-cols-3"> Fixed Cost Budget {{selectedShopForNav.shortname}} </div> </div> </div> <div class="container"> <div class="form-row"> <div class="form-cols-1">Shop Description</div> <div class="form-cols-3">{{selectedShopForNav.shopname}}</div> </div> </div> <div class="container"> <div class="budget-detail"> <div class="project-budget-section"> <div class="form-row"> <div class="form-cols-2 bold">Project-Budget</div> <div class="form-cols-3 bold">{{activeHead.headname}}</div> </div> <div class="form-row"> <div class="form-cols-2">Budget Allocated:</div> <div class="form-cols-2">{{activeHead.budget | currency: "Rs. "}}</div> </div> <div class="form-row"> <div class="form-cols-2">Budget Consumed:</div> <div class="form-cols-2">{{activeHead.amountutilized | currency: "Rs. "}}</div> </div> <div class="form-row"> <div class="form-cols-2">Balance Budget:</div> <div class="form-cols-2">{{activeHead.budget - activeHead.amountutilized | currency: "Rs. "}}</div> </div> </div> <div class="po-section"> <div class="form-row"> <div class="form-cols-2 bold">PO Released:</div> </div> <div class="form-row" style="font-weight:600"> <div class="form-cols-1">PO No.</div> <div class="form-cols-2">Date</div> <div class="form-cols-1">Amount</div> </div> <div ng-repeat="requi in activeHead.requisitions"> <div class="form-row" ng-repeat="po in requi.po"> <div class="form-cols-1">{{po.ponumber}}</div> <div class="form-cols-2">{{po.date.split(\':\')[0]}}</div> <div class="form-cols-1">{{po.amount | currency: "Rs. "}}</div> </div> </div> </div> </div> </div> <div class="container"> <div class="shop-budget-section"> <div class="shop-budget"> <div class="form-row"> <div class="form-cols-1 bold">Shop Budget</div> <div class="form-cols-3 bold">{{selectedShopForNav.shopname}}</div> </div> <div class="form-row"> <div class="form-cols-1">Budget Allocated:</div> <div class="form-cols-1"> <span class="Q-color">Q1:</span> <span>{{selectedShopForNav.shopbudget/4 | currency : "Rs. "}}</span> </div> <div class="form-cols-1"> <span class="Q-color">Q2:</span> <span>{{selectedShopForNav.shopbudget/4 | currency : "Rs. "}}</span> </div> <div class="form-cols-1"> <span class="Q-color">Q3:</span> <span>{{selectedShopForNav.shopbudget/4 | currency : "Rs. "}}</span> </div> <div class="form-cols-1"> <span class="Q-color">Q4:</span> <span>{{selectedShopForNav.shopbudget/4 | currency : "Rs. "}}</span> </div> </div> <div class="form-row"> <div class="form-cols-1">Budget Consumed:</div> <div class="form-cols-1"><span class="Q-color">Q1:</span>Rs:</div> <div class="form-cols-1"><span class="Q-color">Q2:</span>Rs:</div> <div class="form-cols-1"><span class="Q-color">Q3:</span>Rs:</div> <div class="form-cols-1"><span class="Q-color">Q4:</span>Rs:</div> </div> <div class="form-row"> <div class="form-cols-1">Balance Budget:</div> <div class="form-cols-1"><span class="Q-color">Q1:</span>Rs:</div> <div class="form-cols-1"><span class="Q-color">Q2:</span>Rs:</div> <div class="form-cols-1"><span class="Q-color">Q3:</span>Rs:</div> <div class="form-cols-1"><span class="Q-color">Q4:</span>Rs:</div> </div> <div class="form-row"> <div class="form-cols-1">Remark:</div> <div class="form-cols-2"> <textarea type="text" class="input-7" ng-model="newrequisition.remarks"></textarea> </div> </div> </div> </div> <div> <table class="requisition-form" cellspacing="0" cellpadding="0"> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td style="font-size: 10px; vertical-align: top; padding-top: 5px"> Approved By </td> </tr> <tr> <td>Initiator</td> <td>Production Dept Head</td> <td>Production Div Head</td> <td>Shop ME Head</td> <td>ME Div Head</td> <td>GM</td> <td>VP</td> </tr> </table> </div> <div class="button-group"> <button class="button-grashgreen" ng-click="saveRequisition()"> Save </button> <button class="button-brown" onclick="window.print()">Print</button> <a href="#/home"><button class="button-lightblue">Cancel</button></a> </div> </div> </div>'),a.put("views/shopsummary.html",'<div ng-controller="MainCtrl"> <!-- Graph Container start--> <div class="container"> <div ng-repeat="budget in budgets"> <div class="budget"> <span class="budget-title">{{ budget.budgetname}}</span> <span class="bar" style="width: {{budget.width}}px; background: {{budget.color}}"></span> <span class="budget-amount">{{budget.amount | currency:"Rs. "}}</span> </div> </div> <div class="budget-info"> <span class="budget-title">{{utilisationTitle}}</span> <span class="percent"> {{ utilisation.percent | number: 2 }} </span> <button class="button-green" ng-click="groupBudget()">Group Budget</button> </div> </div> <!-- Graph Container end--> <div class="container"> <budget-head></budget-head> <div> <a class="button-lightblue" ng-click="createHead()">Create New Head</a> </div> </div> </div>'),a.put("views/side-nav.html",'<div class="nav-bar" ng-controller="ShopCtrl"> <ul> <li ng-repeat="shop in shops" ng-class="{selected: selectedShopForNav._id == shop._id}" ng-click="selectShop(shop)"> {{shop.shopname}} </li> </ul> </div>')}]);